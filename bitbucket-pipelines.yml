image: px4io/px4-dev-base-focal:latest   # PX4 official dev container with toolchain

options:
  clone:
    depth: full
    submodules: true   # âœ… ensures submodules checkout to pinned commits

pipelines:
  default:
    - step:
        name: Build PX4 for v6C and v6X
        services:
          - docker
        caches:
          - docker
        script:
          - echo "ðŸ”„ Building PX4 firmware for Pixhawk 6C and 6X..."
          # Ensure ARM toolchain is in PATH
          - export PATH="/usr/lib/gcc/arm-none-eabi/bin:$PATH"
          - export PATH="/opt/gcc-arm-none-eabi/bin:$PATH"
          # Check if ARM toolchain is available
          - which arm-none-eabi-gcc || echo "ARM toolchain not found in standard locations"
          - arm-none-eabi-gcc --version || echo "ARM GCC not working, will try to install"
          # Install ARM toolchain if not available
          - apt-get update && apt-get install -y gcc-arm-none-eabi || echo "apt install failed"
          # Verify toolchain after installation
          - which arm-none-eabi-gcc && arm-none-eabi-gcc --version
          # Install required Python dependencies
          - pip3 install symforce
          - make px4_fmu-v6c_default
          - make px4_fmu-v6x_default
        artifacts:
          - build/px4_fmu-v6c_default/px4_fmu-v6c_default.px4
          - build/px4_fmu-v6x_default/px4_fmu-v6x_default.px4
